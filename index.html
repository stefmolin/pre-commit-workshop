<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-25389D1SR4"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-25389D1SR4");
    </script>

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <meta name="robots" content="index,follow" />
    <meta name="keywords" content="technology, open source, slides, Python" />
    <meta name="theme-color" content="#000" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@StefanieMolin" />
    <meta name="twitter:creator" content="@StefanieMolin" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Stefanie Molin" />
    <meta name="author" content="Stefanie Molin" />
    <meta name="referrer" content="origin" />
    <meta
      property="og:url"
      content="https://stefaniemolin.com/pre-commit-workshop/"
    />
    <meta
      property="og:title"
      content="(Pre-)Commit to Better Code | Stefanie Molin"
    />
    <meta
      name="description"
      content="Pre-commit hooks are code checks that run whenever you attempt to commit your changes with Git. They can detect and, in some cases, automatically correct code-quality issues before they make it to your codebase. In this tutorial, you will learn how to install and configure pre-commit hooks for your repository to ensure that only code that passes your checks makes it into your codebase. We will also explore how to build custom pre-commit hooks for novel use cases."
    />
    <meta
      property="og:description"
      content="Pre-commit hooks are code checks that run whenever you attempt to commit your changes with Git. They can detect and, in some cases, automatically correct code-quality issues before they make it to your codebase. In this tutorial, you will learn how to install and configure pre-commit hooks for your repository to ensure that only code that passes your checks makes it into your codebase. We will also explore how to build custom pre-commit hooks for novel use cases."
    />
    <meta
      property="og:image"
      content="https://ogcdn.net/e4b8c678-7bd5-445d-ba03-bfaad510c686/v3/stefaniemolin.com/(Pre-)Commit%20to%20Better%20Code%20workshop%20slides/https%3A%2F%2Fstefaniemolin.com%2Fpre-commit-workshop%2Fimages%2Fcover.jpg/og.png"
    />
    <meta property="og:image:width" content="2160" />
    <meta property="og:image:height" content="1440" />
    <meta property="og:image:alt" content="(Pre-)Commit to Better Code" />

    <title>(Pre-)Commit to Better Code workshop slides | Stefanie Molin</title>
    <link rel="manifest" href="/favicon/site.webmanifest" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/favicon/android-chrome-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="/favicon/android-chrome-512x512.png"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/reveal.js@5.1.0/dist/reset.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/reveal.js@5.1.0/dist/reveal.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/reveal.js@5.1.0/dist/theme/simple.css"
    />

    <!--syntax highlighting in code snippets (light theme)-->
    <link
      rel="stylesheet"
      href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/stackoverflow-light.min.css"
    />

    <!-- Font Awesome icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.1.1/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <style type="text/css">
      :root {
        --r-heading1-size: 2em;
        --r-heading2-size: 1.2em;
        --r-heading3-size: 1em;
        --r-heading4-size: 0.85em;
      }
      .reveal .slides > section {
        text-align: left !important;
      }
      h6 {
        font-size: 0.8em;
      }
      ul,
      ol,
      p {
        font-size: 0.75em;
      }
      ul.references {
        font-size: 0.65em;
      }
      #bio ul {
        font-size: 0.715em;
      }
      ul > li:not(:last-child),
      ol > li:not(:last-child) {
        margin-bottom: 0.5em;
      }
      .center {
        text-align: center;
      }
      small {
        font-size: 0.25em !important;
        text-align: center;
      }
      .footer {
        position: absolute;
        bottom: 25px;
        text-wrap: nowrap;
        width: 100%;
        text-align: center;
        z-index: 100;
        font-size: 0.75em;
      }
      .license {
        position: absolute;
        bottom: 10px;
        text-wrap: nowrap;
        width: 100%;
        text-align: center;
        z-index: 100;
        font-size: 0.25em;
      }
      pre > code {
        padding: 20px !important;
        border-radius: 10px;
      }
      pre.code-wrapper {
        border-radius: 10px;
      }
      :not(pre) > code {
        background-color: #eee;
        padding: 0.125rem 0.25rem;
        border-radius: 5px;
      }
      .hide-line-numbers .hljs-ln-numbers {
        display: none;
      }
      .r-stack-left {
        justify-content: start;
      }
      .r-stack-left > p {
        margin: 0 !important;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="license">
        License:
        <a
          href="http://creativecommons.org/licenses/by-nc-sa/4.0/"
          style="z-index: 1"
          target="_blank"
          rel="noopener noreferrer"
        >
          CC BY-NC-SA 4.0
        </a>
      </div>
      <div class="footer">
        <a href="https://stefaniemolin.com">stefaniemolin.com</a>
      </div>
      <div class="slides">
        <section>
          <h1 class="center">(Pre-)Commit to Better Code</h1>
          <br />
          <br />
          <h2 class="center">Stefanie Molin</h2>
        </section>
        <section id="bio">
          <h2>Bio</h2>
          <ul>
            <li>üë©‚Äçüíª Software engineer at Bloomberg in NYC</li>
            <li>
              üöÄ Creator of the
              <a
                href="https://numpydoc.readthedocs.io/en/latest/validation.html#docstring-validation-using-pre-commit-hook"
                rel="noopener noreferrer"
                >numpydoc-validation</a
              >
              and
              <a
                href="https://github.com/stefmolin/exif-stripper"
                rel="noopener noreferrer"
                >exif-stripper</a
              >
              pre-commit hooks
            </li>
            <li>
              ‚úç Author of "<a
                href="https://stefaniemolin.com/books/Hands-On-Data-Analysis-with-Pandas-2nd-edition/"
                >Hands-On Data Analysis with Pandas</a
              >"
            </li>
            <li>
              üéì Bachelor's in operations research from Columbia University
            </li>
            <li>
              üéì Master's in computer science (ML specialization) from Georgia
              Tech
            </li>
          </ul>
        </section>
        <section id="prerequisites">
          <h2>Prerequisites</h2>
          <div>
            <ul>
              <li>
                Comfort writing Python code and working with Git on the command
                line using basic commands (<em>e.g.</em>, <code>clone</code>,
                <code>status</code>, <code>diff</code>, <code>add</code>,
                <code>commit</code>, and <code>push</code>)
              </li>
              <li>
                Have Python and Git installed on your computer, as well as a
                text editor for writing code (<em>e.g.</em>,
                <a
                  href="https://code.visualstudio.com/"
                  target="_blank"
                  rel="noopener noreferrer"
                  >Visual Studio Code</a
                >)
              </li>
              <li>
                Fork and clone this repository:
                <a
                  href="https://github.com/stefmolin/pre-commit-workshop"
                  target="_blank"
                  rel="noopener noreferrer"
                  >github.com/stefmolin/pre-commit-workshop</a
                >
              </li>
            </ul>
          </div>
        </section>
        <section id="agenda">
          <h2>Agenda</h2>
          <ol>
            <li>
              <a href="#setting-up-pre-commit-hooks"
                >Setting Up Pre-Commit Hooks</a
              >
            </li>
            <li>
              <a href="#creating-a-pre-commit-hook">
                Creating a Pre-Commit Hook</a
              >
            </li>
          </ol>
        </section>
        <section id="setting-up-pre-commit-hooks">
          <h1 class="center">Setting Up Pre-Commit Hooks</h1>
        </section>
        <section id="git-hooks-overview">
          <h2>Overview of Git hooks</h2>
          <div>
            <ul>
              <li class="fragment fade-in" data-fragment-index="1">
                Scripts triggered when taking certain actions on a repository
                (<em>e.g.</em>, committing changes)
              </li>
              <li class="fragment fade-in" data-fragment-index="2">
                Can be client-side or server-side
              </li>
              <li class="fragment fade-in" data-fragment-index="3">
                Stored in the <code>.git/hooks/</code> directory of your
                repository, but excluded from version control
              </li>
            </ul>
            <pre class="fragment fade-in" data-fragment-index="3">
              <code data-trim class="language-plaintext hide-line-numbers" data-line-numbers="1-7|4">
                .git
                ‚îî‚îÄ‚îÄ hooks
                    ‚îú‚îÄ‚îÄ commit-msg.sample
                    ‚îú‚îÄ‚îÄ pre-commit.sample
                    ‚îú‚îÄ‚îÄ pre-merge-commit.sample
                    ‚îú‚îÄ‚îÄ pre-push.sample
                    ‚îî‚îÄ‚îÄ [...]
              </code>
            </pre>
          </div>
        </section>
        <section id="pre-commit-hooks-overview">
          <h2>Overview of pre-commit hooks</h2>
          <div>
            <ul>
              <li class="fragment fade-in" data-fragment-index="1">
                One pre-commit hook executable per repository
              </li>
              <li class="fragment fade-in" data-fragment-index="2">
                Triggered by Git when you run <code>git commit</code>
              </li>
              <li class="fragment fade-in" data-fragment-index="3">
                Often used to enforce coding standards (<em>e.g.</em>, linting
                and formatting)
              </li>
              <li class="fragment fade-in" data-fragment-index="4">
                Should only include checks that run quickly
              </li>
              <li class="fragment fade-in" data-fragment-index="5">
                The commit fails if <em>any</em> of the checks fail
              </li>
            </ul>
          </div>
        </section>
        <section id="how-to-enable-pre-commit-hooks">
          <h2>How to enable pre-commit hooks</h2>
          <div>
            <ol>
              <li class="fragment fade-in" data-fragment-index="1">
                Create an executable script that runs any checks you want to
                include and save it as <code>.git/hooks/pre-commit</code>,
              </li>
              <li class="fragment fade-in" data-fragment-index="2">
                Or, use a tool like <code>pre-commit</code> and include the hook
                configuration in version control.
              </li>
            </ol>
          </div>
        </section>
        <section id="disambiguation">
          <h2>Pre-commit hooks != <code>pre-commit</code></h2>
          <div>
            <ul>
              <li class="fragment fade-in" data-fragment-index="1">
                <code>pre-commit</code> is "a multi-language package manager for
                pre-commit hooks" (<a
                  href="https://pre-commit.com/"
                  target="_blank"
                  rel="noopener noreferrer"
                  >source</a
                >).
              </li>
              <li class="fragment fade-in" data-fragment-index="2">
                <code>pre-commit</code> installs its own script as the
                pre-commit hook executable for your repository.
              </li>
              <li class="fragment fade-in" data-fragment-index="3">
                The installed pre-commit hook then runs <code>pre-commit</code>,
                which in turn runs any checks you specify using a YAML file.
              </li>
            </ul>
          </div>
        </section>
        <section id="pre-commit-setup">
          <h2>Setup</h2>
          <div>
            <ol>
              <li
                class="fragment fade-in-then-semi-out"
                data-fragment-index="1"
              >
                Install the <code>pre-commit</code> package in your repository.
              </li>
              <li
                class="fragment fade-in-then-semi-out"
                data-fragment-index="2"
              >
                Define the checks you want to use in a file called
                <code>.pre-commit-config.yaml</code>.
              </li>
              <li
                class="fragment fade-in-then-semi-out"
                data-fragment-index="3"
              >
                Have <code>pre-commit</code> install itself as your pre-commit
                hook.
              </li>
              <li
                class="fragment fade-in-then-semi-out"
                data-fragment-index="4"
              >
                Work on your code as usual.
              </li>
            </ol>
          </div>
        </section>
        <section id="pre-commit-package-installation">
          <h3>Package installation</h3>
          <pre>
            <code data-trim class="language-shell">
              $ python3 -m pip install pre-commit
            </code>
          </pre>
        </section>
        <section id="basic-configuration">
          <h3>Basic configuration</h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Defined in <code>.pre-commit-config.yaml</code> at the repository
              root:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              The <code>repos</code> section lists the repositories to use:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              This represents the configuration for a single repository:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              The URL of the repository to clone:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              The tag or commit hash to clone at:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="5">
              The hooks to run from that repository:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
              <code data-trim class="language-yaml" data-line-numbers="1-8|1|2-8|2|3|4-8" data-fragment-index="1">
                repos:
                  - repo: https://github.com/pre-commit/pre-commit-hooks
                    rev: v4.5.0
                    hooks:
                      - id: check-toml
                      - id: check-yaml
                      - id: end-of-file-fixer
                      - id: trailing-whitespace
              </code>
            </pre>
            <small
              ><em
                >Source:
                <a
                  href="https://stefaniemolin.com/articles/devx/pre-commit/setup-guide/"
                  rel="noopener noreferrer"
                  target="_blank"
                  >How to Set Up Pre-Commit Hooks</a
                >
                by Stefanie Molin</em
              ></small
            >
          </div>
        </section>
        <section id="git-hook-installation">
          <h3>Git hook installation</h3>
          <p>
            While the <code>.pre-commit-config.yaml</code> file lives in version
            control, each contributor must run this locally:
          </p>
          <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1">
              $ pre-commit install
              pre-commit installed at .git/hooks/pre-commit
            </code>
          </pre>
        </section>
        <section id="committing-the-configuration-file">
          <h3>Add the configuration to version control</h3>
          <p>
            The <code>check-yaml</code> hook we included will make sure that the
            <code>.pre-commit-config.yaml</code> file (and any other YAML files
            in this repository) is valid YAML. Try committing it:
          </p>
          <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1-2|3-6|7-11">
              $ git add .pre-commit-config.yaml
              $ git commit -m "Add pre-commit config"
              [INFO] Initializing environment for [...]/pre-commit-hooks.
              [INFO] Installing environment for [...]/pre-commit-hooks.
              [INFO] Once installed this environment will be reused.
              [INFO] This may take a few minutes...
              check toml..........................(no files to check)Skipped
              check yaml..............................................Passed
              fix end of files........................................Passed
              trim trailing whitespace................................Passed
            </code>
          </pre>
        </section>
        <section id="exercise-1-1">
          <h2>Exercise</h2>
          <p>
            There are more hooks provided by the repository that we are
            currently using. Take a moment to look through their documentation,
            and add some additional hooks to the setup that are relevant to your
            work. Be sure to commit your changes.
          </p>
          <p class="center">
            <a
              href="https://github.com/pre-commit/pre-commit-hooks"
              target="_blank"
              rel="noopener noreferrer"
              >github.com/pre-commit/pre-commit-hooks</a
            >
          </p>
        </section>
        <section id="example-solution-1-1">
          <h2>Example solution</h2>
          <p>
            Adding these two hooks ensures that your scripts are actually
            executable:
          </p>
          <pre>
            <code data-trim class="language-diff hide-line-numbers" data-line-numbers="5-6">
               repos:
                 - repo: https://github.com/pre-commit/pre-commit-hooks
                   rev: v4.5.0
                   hooks:
              +      - id: check-executables-have-shebangs
              +      - id: check-shebang-scripts-are-executable
                     - id: check-toml
                     - id: check-yaml
                     - id: end-of-file-fixer
                     - id: trailing-whitespace
            </code>
          </pre>
        </section>
        <section id="third-party-hooks">
          <h2>Third-party hooks</h2>
          <p>
            We are free to use hooks from multiple repositories. A
            non-exhaustive list of popular hooks along with tips for searching
            for compatible repositories can be found at
            <a
              href="https://pre-commit.com/hooks.html"
              target="_blank"
              rel="noopener noreferrer"
              >pre-commit.com/hooks.html</a
            >.
          </p>
          <div class="fragment">
            <p>
              Let's add
              <code
                ><a
                  href="https://docs.astral.sh/ruff/"
                  target="_blank"
                  rel="noopener noreferrer"
                  >ruff</a
                ></code
              >
              to lint and format our Python code, since it is "10-100x faster
              than existing linters (like Flake8) and formatters (like
              Black),"<sup>*</sup>
              and speed very is important with pre-commit hooks.
            </p>

            <hr align="left" style="width: 33%" />
            <div style="padding-left: 10px; width: 90%; margin-bottom: -15px">
              <small
                ><sup>*</sup> Source:
                <a
                  href="https://docs.astral.sh/ruff/"
                  target="_blank"
                  rel="noopener noreferrer"
                  ><code>ruff</code> homepage</a
                >
                as of June 16, 2024</small
              >
            </div>
          </div>
        </section>
        <section id="adding-ruff">
          <h3>
            Adding <code>ruff</code> to <code>.pre-commit-config.yaml</code>
          </h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Create a new entry under the <code>repos</code> key:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              The <code>ruff</code> pre-commit hook is in a separate repository:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              The tag or commit hash to clone at:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              The hooks to run from that repository:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              Use <code>args</code> to pass command line arguments to the hook:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-yaml" data-line-numbers="10-15|10|11|12-15|14" data-fragment-index="1">
              repos:
                - repo: https://github.com/pre-commit/pre-commit-hooks
                  rev: v4.5.0
                  hooks:
                    - id: check-toml
                    - id: check-yaml
                    - id: end-of-file-fixer
                    - id: trailing-whitespace

                - repo: https://github.com/astral-sh/ruff-pre-commit
                  rev: v0.4.10
                  hooks:
                    - id: ruff
                      args: [--fix, --exit-non-zero-on-fix, --show-fixes]
                    - id: ruff-format
            </code>
          </pre>
          </div>
        </section>
        <section id="committing-after-changing-the-configuration">
          <h3>Commit your changes</h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              This once again triggers an update to the environment used for
              running the checks:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              All hooks that were added or modified hooks need to be updated in
              the environment:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              This will be slower the first time, but the environment persists
              until modification:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              Hook order in the configuration file matters &ndash; hooks run in
              the order you specify and may make conflicting changes:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1-2|3-4|5-6|11-12" data-fragment-index="1">
              $ git add .pre-commit-config.yaml
              $ git commit -m "Add ruff pre-commit hooks"
              [INFO] Initializing environment for [...]/ruff-pre-commit.
              [INFO] Installing environment for [...]/ruff-pre-commit.
              [INFO] Once installed this environment will be reused.
              [INFO] This may take a few minutes...
              check toml..........................(no files to check)Skipped
              check yaml..............................................Passed
              fix end of files........................................Passed
              trim trailing whitespace................................Passed
              ruff................................(no files to check)Skipped
              ruff-format.........................(no files to check)Skipped
            </code>
          </pre>
          </div>
        </section>
        <section id="testing-the-ruff-pre-commit-hooks">
          <h3>Testing the <code>ruff</code> pre-commit hooks</h3>
          <p>
            Create a new file called <code>example.py</code> with the following
            contents, and try to commit it:
          </p>
          <pre>
            <code data-trim class="language-python">
              import re

              def my_function(a):
                  """My function."""
                  pass
            </code>
          </pre>
        </section>
        <section id="failing-checks">
          <h3>The commit fails</h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              No TOML or YAML files to check:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              No issues with these checks:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              <code>ruff</code> modified a file, which is an automatic failure:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              <code>ruff</code> found an unused import when linting:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              <code>ruff</code> summarizes its findings (sometimes we have to
              fix it):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="5">
              <code>ruff</code> also made a change while formatting the file:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1-2|3-4|5-14|10-12|14|16-20" data-fragment-index="1">
              check toml..........................(no files to check)Skipped
              check yaml..........................(no files to check)Skipped
              fix end of files........................................Passed
              trim trailing whitespace................................Passed
              ruff....................................................Failed
              - hook id: ruff
              - exit code: 1
              - files were modified by this hook

              Fixed 1 error:
              - example.py:
                  1 √ó F401 (unused-import)

              Found 1 error (1 fixed, 0 remaining).

              ruff-format.............................................Failed
              - hook id: ruff-format
              - files were modified by this hook

              1 file reformatted
            </code>
          </pre>
          </div>
        </section>
        <section id="verify-changes-made-by-hooks">
          <h3>Verify the changes before trying again</h3>
          <pre>
              <code data-trim class="language-diff">
                $ git diff example.py
                diff --git a/example.py b/example.py
                index ebb29eb..ad4c89e 100644
                --- a/example.py
                +++ b/example.py
                @@ -1,5 +1,3 @@
                -import re
                -
                def my_function(a):
                    """My function."""
                    pass
              </code>
            </pre>
        </section>
        <section id="checks-passing">
          <h3>The commit succeeds now</h3>
          <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1-2,9-11">
              $ git add example.py
              $ git commit -m "Add example.py"
              check toml..........................(no files to check)Skipped
              check yaml..........................(no files to check)Skipped
              fix end of files........................................Passed
              trim trailing whitespace................................Passed
              ruff....................................................Passed
              ruff-format.............................................Passed
              [example 79b0f28] Add example.py
               1 file changed, 3 insertions(+)
               create mode 100644 example.py
            </code>
          </pre>
        </section>
        <section id="exercise-1-2">
          <h2>Exercise</h2>
          <p>
            Look at the setup information for the
            <code>numpydoc-validation</code> hook at
            <a
              href="https://numpydoc.readthedocs.io/en/latest/validation.html"
              target="_blank"
              rel="noopener noreferrer"
              >numpydoc.readthedocs.io/en/latest/validation.html</a
            >, and add it to your configuration. Be sure to commit your changes.
          </p>
          <p>
            <em
              >Tip: You can run the following to check for any formatting
              errors:</em
            >
          </p>
          <pre>
            <code data-trim class="language-shell">
              $ pre-commit validate-config .pre-commit-config.yaml
            </code>
          </pre>
        </section>
        <section id="example-solution-1-2">
          <h2>Example solution</h2>
          <p>Adding the <code>numpydoc-validation</code> hook:</p>
          <pre>
            <code data-trim class="language-yaml">
              - repo: https://github.com/numpy/numpydoc
                rev: v1.7.0
                hooks:
                  - id: numpydoc-validation
            </code>
          </pre>
        </section>
        <section id="running-hooks-on-demand">
          <h2>Running hooks on demand</h2>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Run all hooks on staged changes:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              Run all hooks on <code>example.py</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Run only the <code>numpydoc-validation</code> hook on all files:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1|2|3" data-fragment-index="1">
              $ pre-commit run
              $ pre-commit run --files example.py
              $ pre-commit run numpydoc-validation --all-files
            </code>
          </pre>
          </div>
        </section>
        <section id="docstring-validation">
          <h2>Validating docstrings</h2>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Run <code>numpydoc-validation</code> hook on
              <code>example.py</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              <code>example.py</code> fails the docstring checks:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Without any additional configuration, all numpydoc checks are run:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1|2-4|6-18" data-fragment-index="1">
              $ pre-commit run numpydoc-validation --files example.py
              numpydoc-validation.....................................Failed
              - hook id: numpydoc-validation
              - exit code: 1

              +---------------------+-------+------------------------------+
              | item                | check | description                  |
              +=====================+=======+==============================+
              | example             | GL08  | The object missing docstring |
              +---------------------+-------+------------------------------+
              | example.my_function | ES01  | No extended summary found    |
              +---------------------+-------+------------------------------+
              | example.my_function | PR01  | Param {'a'} not documented   |
              +---------------------+-------+------------------------------+
              | example.my_function | SA01  | See Also section not found   |
              +---------------------+-------+------------------------------+
              | example.my_function | EX01  | No examples section found    |
              +---------------------+-------+------------------------------+

            </code>
          </pre>
            <small><em>Output abbreviated.</em></small>
          </div>
        </section>
        <section id="modifying-hooks">
          <h2>Modifying hook behavior</h2>
          <p>Two options:</p>
          <ul>
            <li class="fragment">via command line arguments</li>
            <li class="fragment">via a configuration file</li>
          </ul>
        </section>
        <section id="modifying-hooks-with-args">
          <h3>Modifying hook behavior with command line arguments</h3>
          <p>
            For behavior that you only want to happen when the tool is run as a
            pre-commit hook (we want the issues fixed automatically here, but
            perhaps when we run <code>ruff</code> on our own, we just want it to
            report on what it would have changed):
          </p>
          <pre>
            <code data-trim class="language-yaml hide-line-numbers" data-line-numbers="4-5">
              - repo: https://github.com/astral-sh/ruff-pre-commit
                rev: v0.4.10
                hooks:
                  - id: ruff
                    args: [--fix, --exit-non-zero-on-fix, --show-fixes]
                  - id: ruff-format
            </code>
          </pre>
        </section>
        <section id="modifying-hooks-with-configuration-file">
          <h3>Modifying hook behavior with a configuration file</h3>
          <p>
            For settings that should be applied for every invocation of the
            tool:
          </p>
          <pre>
            <code data-trim class="language-toml hide-line-numbers" data-line-numbers="2-3|5-7|9-21">
              # pyproject.toml (the tool must support this file)
              [tool.ruff]
              line-length = 88

              [tool.ruff.format]
              indent-style = "space"
              quote-style = "single"

              [tool.ruff.lint]
              select = [
                  "B", # flake8-bugbear rules
                  "C", # mccabe rules
                  "E", # pycodestyle error rules
                  "F", # pyflakes rules
                  "I", # isort rules
                  "W", # pycodestyle warning rules
              ]
              ignore = [
                  "C901", # max-complexity-10
                  "E501", # line-too-long
              ]
            </code>
          </pre>
        </section>
        <section id="exercise-1-3">
          <h2>Exercise</h2>
          <p>
            Configure the <code>numpydoc-validation</code> hook to ignore the
            checks ES01, EX01, SA01, and SS06. Then, address any issues in
            <code>example.py</code> so that it passes the checks.
          </p>
          <p class="center">
            <a
              href="https://numpydoc.readthedocs.io/en/latest/validation.html"
              target="_blank"
              rel="noopener noreferrer"
              >numpydoc.readthedocs.io/en/latest/validation.html</a
            >
          </p>
        </section>
        <section id="example-solution-1-3-pyproject">
          <h2>Example solution</h2>
          <p>
            First, specify which checks to report in the configuration file:
          </p>
          <pre>
            <code data-trim class="language-toml">
              # pyproject.toml (this tool supports pyproject.toml)
              [tool.numpydoc_validation]
              checks = [
                  "all",  # report on all checks
                  "ES01", # but don't require an extended summary
                  "EX01", # or examples
                  "SA01", # or a see also section
                  "SS06", # and don't require the summary to fit on one line
              ]
            </code>
          </pre>
        </section>
        <section id="example-solution-1-3-docstrings">
          <p>Then, update the docstrings in <code>example.py</code>:</p>
          <pre>
            <code data-trim class="language-python">
              """Utility functions."""


              def my_function(a):
                  """
                  My function.

                  Parameters
                  ----------
                  a : int
                      The value to use.
                  """
                  pass
            </code>
          </pre>
        </section>
        <section id="excluding-files">
          <h2>Excluding files</h2>
          <p>
            The docstring checks are strict, but things like the test suite
            won't end up in our documentation, so we are creating extra work.
            Let's restrict when the docstring checks will run:
          </p>
          <pre>
            <code data-trim class="language-diff hide-line-numbers" data-line-numbers="5">
              - repo: https://github.com/numpy/numpydoc
                rev: v1.7.0
                hooks:
                  - id: numpydoc-validation
            +       exclude: (tests|docs)/.*
            </code>
          </pre>
          <p class="fragment">
            <em>
              Tip: Inclusive filtering on the file name is also supported with
              <code>files</code>. File type filtering is also available. See the
              <a
                href="https://pre-commit.com/#pre-commit-configyaml---hooks"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit documentation</a
              >
              for all supported options.
            </em>
          </p>
        </section>
        <section id="autoupdate">
          <h2>Keeping hooks up-to-date</h2>
          <p>
            Run <code>pre-commit autoupdate</code> to update all hooks to their
            latest versions (the <code>rev</code> key in the YAML):
          </p>
          <pre>
            <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1">
              $ pre-commit autoupdate
              Updating [...]/pre-commit-hooks ... updating v4.5.0 -> v4.6.0.
              Updating [...]/ruff-pre-commit ... updating v0.4.10 -> v0.5.1.
              Updating [...]/numpy/numpydoc ... already up to date.
            </code>
          </pre>
          <p class="fragment">
            <b>Warning:</b> Make sure these new versions work with your setup by
            running <code>pre-commit run --all-files</code>.
          </p>
        </section>
        <section id="tips-for-using-hooks">
          <h2>Good to know</h2>
          <ul>
            <li class="fragment">
              Pass <code>--no-verify</code> when committing to bypass the
              checks.
            </li>
            <li class="fragment">
              Hooks can be configured to run at different Git stages
              (<em>e.g.</em>, pre-push).
            </li>
            <li class="fragment">
              Check out
              <a
                href="https://pre-commit.com/hooks.html"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit.com/hooks.html</a
              >
              for tips on finding hooks.
            </li>
            <li class="fragment">
              Use <code>pre-commit run --all-files</code> to run your hooks in
              CI/CD workflows (or you can use
              <a
                href="https://pre-commit.ci/"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit.ci</a
              >).
            </li>
          </ul>
        </section>

        <section id="creating-a-pre-commit-hook">
          <h1 class="center">Creating a Pre-Commit Hook</h1>
        </section>
        <section id="hook-recipe">
          <h2>Recipe</h2>
          <ol>
            <li class="fragment">Implement the check(s) in a function.</li>
            <li class="fragment">Wrap the function in a CLI.</li>
            <li class="fragment">Make it installable.</li>
            <li class="fragment">Configure it as a hook.</li>
          </ol>
        </section>
        <section id="hook-recipe-step-1">
          <h2>1. Implement the check(s) in a function</h2>
          <pre>
            <code data-trim class="language-python hide-line-numbers" data-line-numbers="1-11|3,5|6,9|7,11">
              from typing import Sequence

              def perform_check(filenames: Sequence[str]) -> int:
                  """
                  Given a sequence of filenames,
                  perform the check(s),
                  return 1 if there is a failure, 0 otherwise.
                  """
                  failure = ?  # your logic

                  return 1 if failure else 0
            </code>
          </pre>
        </section>
        <section id="example-check">
          <h3>Toy example</h3>
          <p>Only allow committing one file at a time:</p>
          <pre>
            <code data-trim class="language-python hide-line-numbers" data-line-numbers="9-11">
              from typing import Sequence

              def perform_check(filenames: Sequence[str]) -> int:
                  """
                  Given a sequence of filenames,
                  check the number of files,
                  return 1 if there is a failure, 0 otherwise.
                  """
                  failure = len(filenames) > 1

                  return 1 if failure else 0
            </code>
          </pre>
        </section>
        <section id="exif-stripper-simplified-check">
          <h3>Simplified example from <code>exif-stripper</code></h3>
          <p>
            This hook removes metadata from images, and the check is implemented
            to run on a single file at once.
          </p>
          <div class="center">
            <pre>
            <code data-trim class="language-python hide-line-numbers" data-line-numbers="1-15|3|6-11|15">
              from PIL import Image, UnidentifiedImageError

              def process_image(filename: str) -> bool:  # given a file
                  has_changed = False
                  try:
                      with Image.open(filename) as im:
                          if exif := im.getexif():  # run check
                              exif.clear()  # edit file to fix the issue
                              im.save(filename)
                              has_changed = True
                              print(f'Stripped metadata from {filename}')
                  except (FileNotFoundError, UnidentifiedImageError):
                      pass  # not an image

                  return has_changed  # report result
            </code>
          </pre>
            <small
              >Simplified to only strip EXIF data.
              <em
                >Source:
                <a
                  href="https://github.com/stefmolin/exif-stripper"
                  rel="noopener noreferrer"
                  target="_blank"
                  >stefmolin/exif-stripper</a
                ></em
              ></small
            >
          </div>
        </section>
        <section id="helpful-hooks">
          <h2>What makes a helpful hook?</h2>
          <ol>
            <li class="fragment">Runs quickly</li>
            <li class="fragment">
              Tells you what is wrong and where the issue is (the file and,
              potentially, line number)
            </li>
            <li class="fragment">
              Fixes the file for you, if possible, or, if not, guides you to the
              fix
            </li>
          </ol>
        </section>
        <section id="exercise-2-1">
          <h2>Exercise</h2>
          <p>
            Come up with your own check. It doesn't matter if something already
            exists for your idea. If you can't think of anything, try creating a
            check that enforces a file naming convention that you follow.
          </p>
          <p>
            Write your code in the
            <code>src/your_pkg/your_module.py</code> file, renaming both the
            directory and file as you see fit.
          </p>
        </section>
        <section id="example-solution-2-1">
          <h2>Example solution</h2>
          <p>
            Require filenames to be at least three characters (without the
            extension):
          </p>
          <pre>
          <code data-trim class="language-python hide-line-numbers" data-line-numbers="1-12|3|4-5|7-9|11-12">
            from pathlib import Path

            def validate_filename(filename: str, min_len: int = 3) -> int:
                # extract the name so that `/my/repo/x.py` becomes `x`
                name = Path(filename).stem

                # check the length
                if failure := len(name) < min_len:
                    print(f'Name too short ({min_len=}): {filename}')

                # convert to an exit code for later
                return int(failure)
          </code>
        </pre>
        </section>
        <section id="hook-recipe-step-2">
          <h2>2. Wrap your function in a CLI</h2>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              We will use <code>argparse</code> for this example:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              At a minimum, we need to accept filenames:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              We can then parse the received arguments:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              Run your check(s) on each item in <code>args.filenames</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              Return 1 if there were any failures, 0 otherwise:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-python hide-line-numbers" data-line-numbers="1,5|6-10|2,4,12|14|15" data-fragment-index="1">
              import argparse
              from typing import Sequence

              def main(argv: Sequence[str] | None = None) -> int:
                  parser = argparse.ArgumentParser(prog='your-hook')
                  parser.add_argument(
                      'filenames',
                      nargs='*',
                      help='Filenames to process.',
                  )

                  args = parser.parse_args(argv)

                  failures = ?  # run your check(s) on `args.filenames`
                  return 1 if failures else 0  # must be 0 or 1 this time
            </code>
          </pre>
          </div>
        </section>
        <section id="exif-stripper-simplified-cli">
          <h3>Simplified example from <code>exif-stripper</code></h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Create the <code>ArgumentParser</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              Parse the received arguments:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Process each file, storing the outcomes (these are Boolean
              values):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              Aggregate the results, returning 1 if there were any failures, 0
              otherwise:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-python hide-line-numbers" data-line-numbers="1,5-10|2,4,12|13-17|18" data-fragment-index="1">
              import argparse
              from typing import Sequence

              def main(argv: Sequence[str] | None = None) -> int:
                  parser = argparse.ArgumentParser(prog='strip-exif')
                  parser.add_argument(
                      'filenames',
                      nargs='*',
                      help='Filenames to process.',
                  )

                  args = parser.parse_args(argv)

                  results = [
                      process_image(filename)
                      for filename in args.filenames
                  ]
                  return int(any(results))
            </code>
          </pre>
            <small>
              <em
                >Source:
                <a
                  href="https://github.com/stefmolin/exif-stripper"
                  rel="noopener noreferrer"
                  target="_blank"
                  >stefmolin/exif-stripper</a
                ></em
              ></small
            >
          </div>
        </section>
        <section id="exercise-2-2">
          <h2>Exercise</h2>
          <p>
            Create a CLI for the check function you created in the previous
            exercise. Add an optional command line argument to modify how your
            check behaves.
          </p>
          <p>
            You can put this in the same file from the previous exercise or in
            another file in the same directory (<em>e.g.</em>,
            <code>src/your_pkg/cli.py</code>).
          </p>
        </section>
        <section id="example-solution-2-2">
          <h2>Example solution</h2>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Here, we continue with the hook requiring filenames of a certain
              length:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              Most of this is identical to the example:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              But, this time we add the minimum length as an optional argument:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              When we run the checks on each file, we also pass it in:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
          <code data-trim class="language-python hide-line-numbers" data-line-numbers="1-26|1-12,19-26|13-18|23" data-fragment-index="1">
            import argparse
            from typing import Sequence

            def main(argv: Sequence[str] | None = None) -> int:
                parser = argparse.ArgumentParser(
                    prog='validate-filename'
                )
                parser.add_argument(
                    'filenames',
                    nargs='*',
                    help='Filenames to process.',
                )
                parser.add_argument(
                    '--min-len',
                    default=3,
                    type=int,
                    help='Minimum length for a filename.',
                )

                args = parser.parse_args(argv)

                results = [
                    validate_filename(filename, args.min_len)
                    for filename in args.filenames
                ]
                return int(any(results))
          </code>
        </pre>
          </div>
        </section>
        <section id="hook-recipe-step-3">
          <h2>3. Make it installable</h2>
          <ul>
            <li class="fragment">It can be a package or standalone script.</li>
            <li class="fragment">You must state all dependencies.</li>
            <li class="fragment">Installation should create an executable.</li>
          </ul>
        </section>
        <section id="exif-stripper-simplified-file-structure">
          <h3>Package example with <code>exif-stripper</code></h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Let's look at the file structure for a Python package:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              For this example, the repository name is
              <code>exif-stripper</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Configuration file to have <code>pre-commit</code> run hooks on
              our code:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              Configuration file for our new hook (for the
              <code>strip-exif</code> hook, here):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              Important files for any codebase:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="5">
              This package uses the src-layout:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="6">
              Tests for the logic to make this easier to maintain:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="7">
              The <code>pyproject.toml</code> file is used to install this:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code class="language-plaintext hide-line-numbers" data-trim data-line-numbers="1-12|1|2|3|4-5|7-10|11-12|6" data-fragment-index="1">
              exif-stripper
              ‚îú‚îÄ‚îÄ .pre-commit-config.yaml
              ‚îú‚îÄ‚îÄ .pre-commit-hooks.yaml
              ‚îú‚îÄ‚îÄ LICENSE
              ‚îú‚îÄ‚îÄ README.md
              ‚îú‚îÄ‚îÄ pyproject.toml
              ‚îú‚îÄ‚îÄ src
              ‚îÇ   ‚îî‚îÄ‚îÄ exif_stripper
              ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
              ‚îÇ       ‚îî‚îÄ‚îÄ cli.py
              ‚îî‚îÄ‚îÄ tests
                  ‚îî‚îÄ‚îÄ test_cli.py
            </code>
          </pre>
            <small
              >Based on
              <a
                href="https://github.com/stefmolin/exif-stripper"
                rel="noopener noreferrer"
                target="_blank"
                >stefmolin/exif-stripper</a
              ></small
            >
          </div>
        </section>
        <section id="pyproject-toml">
          <h3><code>pyproject.toml</code></h3>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              This is a template <code>pyproject.toml</code> file:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              Name your distribution (likely the name of your repository):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Provide a version (can also be done
              <a
                href="https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html#dynamic-metadata"
                target="_blank"
                rel="noopener noreferrer"
                >dynamically</a
              >):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              Provide information about your project:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              Include all dependencies required to use your hook here:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="5">
              Optional dependencies for development of the hook go here,
              instead:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="6">
              Creating a package is recommended for testing and reuse:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="7">
              Create an executable for calling your hook's CLI:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-toml hide-line-numbers" data-line-numbers="1-31|6|7|8-17|19-20|21-24|29-31|27" data-fragment-index="1">
              [build-system]
              requires = ["setuptools", "setuptools-scm"]
              build-backend = "setuptools.build_meta"

              [project]
              name = "your-pre-commit-hook"
              version = "0.1.0"
              authors = [{name = "Your Name", email = "email@example.com"},]
              description = "TODO"
              readme = "README.md"
              license = {file = "LICENSE"}
              classifiers = [
                  "Development Status :: 1 - Planning",  # update later
                  "Programming Language :: Python"
              ]
              urls.Homepage = "https://example.com"
              urls.Documentation = "https://example.com/docs"

              dependencies = ["your-hook-dependencies"]
              requires-python = ">=3.8"
              optional-dependencies.dev = [
                  "pre-commit",  # so you can run hooks on the codebase
                  "pytest",  # remember to add tests for your hook
              ]

              # TODO: update `your-script-name` and the path
              scripts.your-script-name = "your_pkg.your_module:hook_function"

              # optional (if you are making a package)
              [tool.setuptools.packages.find]
              where = ["src"]
            </code>
          </pre>
            <small
              >Based on
              <a
                href="https://github.com/stefmolin/pre-commit-example"
                rel="noopener noreferrer"
                target="_blank"
                >stefmolin/pre-commit-example</a
              ></small
            >
          </div>
        </section>
        <section id="exif-stripper-entry-point">
          <h3>Example of specifying the entry point</h3>
          <p>
            When the <code>exif_stripper</code> package is installed, an entry
            point (executable) called, <code>strip-exif</code>, is created
            automatically, which when run calls the <code>main()</code> function
            in the <code>exif_stripper.cli</code> module:
          </p>
          <div class="center">
            <pre>
            <code data-trim class="language-toml">
              scripts.strip-exif = "exif_stripper.cli:main"
            </code>
          </pre>
            <small
              ><em
                >Source:
                <a
                  href="https://github.com/stefmolin/exif-stripper"
                  rel="noopener noreferrer"
                  target="_blank"
                  >stefmolin/exif-stripper</a
                ></em
              ></small
            >
          </div>
        </section>
        <section id="exercise-2-3">
          <h2>Exercise</h2>
          <p>
            Using the provided template, populate the
            <code>pyproject.toml</code> file for your hook from the previous
            exercise. Be sure to create an entry point that will hit the CLI.
          </p>
          <p>
            Confirm that you can <code>pip install</code> it (note that you will
            need to create any files referenced in the
            <code>pyproject.toml</code>, such as <code>README.md</code>).
          </p>
        </section>
        <section id="example-solution-2-3">
          <h2>Example solution</h2>
          <pre>
          <code data-trim class="language-toml hide-line-numbers" data-line-numbers="1-33|6-17|19-20|26">
            [build-system]
            requires = ["setuptools", "setuptools-scm"]
            build-backend = "setuptools.build_meta"

            [project]
            name = "filename-validation"
            version = "0.1.0"
            authors = [
              {name = "Stefanie Molin", email = "email@example.com"},
            ]
            description = "Validates that filenames meet criteria."
            readme = "README.md"
            license = {file = "LICENSE"}
            classifiers = [
                "Development Status :: 3 - Alpha",
                "Programming Language :: Python"
            ]

            dependencies = []
            requires-python = ">=3.8"
            optional-dependencies.dev = [
                "pre-commit",
                "pytest",
            ]

            scripts.validate-filename = "filename_validation.cli:main"

            [project.urls]
            Homepage = "https://github.com/stefmolin/validate-filename"
            Documentation = "https://stefaniemolin.com/validate-filename"

            [tool.setuptools.packages.find]
            where = ["src"]
          </code>
        </pre>
        </section>
        <section id="hook-recipe-step-4">
          <h2>4. Configure it as a hook</h2>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Configuration goes in
              <code>.pre-commit-hooks.yaml</code> as a list of hooks:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              The hook ID (we can use this to run just this hook):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Display name for the hook when the checks are run:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              (Optional) Description of what your hook does:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              The entry point or executable to run, which can also include
              arguments:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="5">
              The language your hook is written in (so
              <code>pre-commit</code> can install it):
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="6">
              (Optional) Restrict this hook to only run on certain file types:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
            <code data-trim class="language-yaml hide-line-numbers" data-line-numbers="1-6|1|2|3|4|5|6" data-fragment-index="1">
              - id: strip-exif
                name: strip-exif
                description: This hook strips image metadata.
                entry: strip-exif
                language: python
                types: [image]
            </code>
          </pre>
            <small
              ><em
                >Source:
                <a
                  href="https://github.com/stefmolin/exif-stripper"
                  rel="noopener noreferrer"
                  target="_blank"
                  >stefmolin/exif-stripper</a
                ></em
              ></small
            >
          </div>
        </section>
        <section id="exercise-2-4">
          <h2>Exercise</h2>
          <p>
            Create a <code>.pre-commit-hooks.yaml</code> file for configuring
            your hook from the previous exercise. Note that, by default, hooks
            will run in parallel, if you need to run in serial, specify
            <code>require_serial: true</code>. Be sure to consult
            <a
              href="https://pre-commit.com/#creating-new-hooks"
              target="_blank"
              rel="noopener noreferrer"
              >pre-commit.com/#creating-new-hooks</a
            >
            for a listing of the configuration options.
          </p>
          <p>
            <em
              >Tip: You can run the following to check for any formatting
              errors:</em
            >
          </p>
          <pre>
            <code data-trim class="language-shell">
              $ pre-commit validate-manifest .pre-commit-hooks.yaml
            </code>
          </pre>
        </section>
        <section id="example-solution-2-4">
          <h2>Example solution</h2>
          <p>
            Continuing the example from previous exercises, we can use the
            following as our <code>.pre-commit-hooks.yaml</code> file for the
            hook to validate the length of the filename:
          </p>
          <pre>
            <code data-trim class="language-yaml">
              - id: validate-filename
                name: validate-filename
                description: This hook checks filename length.
                entry: validate-filename
                language: python
            </code>
        </pre>
        </section>
        <section id="testing-hook-configuration">
          <h2>Testing the hook configuration</h2>
          <ul>
            <li class="fragment">
              Run <code>pre-commit try-repo</code>. (<a
                href="https://pre-commit.com/#developing-hooks-interactively"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit.com/#developing-hooks-interactively</a
              >)
            </li>
            <li class="fragment">
              Add your new hook to the
              <code>.pre-commit-config.yaml</code> file in another repository,
              and set the <code>rev</code> value to the most recent commit hash.
              Then, you can run your hook with <code>pre-commit run</code>.
            </li>
          </ul>
        </section>
        <section id="exercise-2-5">
          <h2>Exercise</h2>
          <p>Test that your hook is properly configured.</p>
        </section>
        <section id="example-solution-2-5">
          <h2>Example solution</h2>
          <div class="r-stack r-stack-left">
            <p class="fragment fade-in-then-out" data-fragment-index="0">
              Start by creating a file that will fail the check:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="1">
              Run <code>pre-commit try-repo</code> passing in the file:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="2">
              Now, <code>pre-commit</code> will generate a configuration for us:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="3">
              Think of this as the <code>.pre-commit-config.yaml</code> file
              that will be used:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="4">
              The <code>repo</code> points to the path we passed to
              <code>pre-commit try-repo</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="5">
              The <code>rev</code> is set to the most recent commit hash:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="6">
              The hooks are pulled out of <code>.pre-commit-hooks.yaml</code>:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="7">
              Just like before, <code>pre-commit</code> will need to set up the
              environment:
            </p>
            <p class="fragment fade-in-then-out" data-fragment-index="8">
              As expected, <code>x.py</code> fails the
              <code>validate-filename</code> check:
            </p>
          </div>
          <div class="center fragment" data-fragment-index="0">
            <pre>
                <code data-trim class="language-shell hide-line-numbers" data-line-numbers="1|2|3-12|7-11|8|9|10-11|13-15|16-20"  data-fragment-index="1">
                  $ touch x.py
                  $ pre-commit try-repo . --files x.py
                  [INFO] Initializing environment for ..
                  =============================================================
                  Using config:
                  =============================================================
                  repos:
                  -   repo: .
                      rev: e11041f74c8a0f074f0633138506dce2efe9c5e7
                      hooks:
                      -   id: validate-filename
                  =============================================================
                  [INFO] Installing environment for ..
                  [INFO] Once installed this environment will be reused.
                  [INFO] This may take a few minutes...
                  validate-filename......................................Failed
                  - hook id: validate-filename
                  - exit code: 1

                  Name too short (min_len=3): x.py
                </code>
            </pre>
          </div>
        </section>
        <section id="maintaining-your-hook">
          <h2>Maintaining your hook</h2>
          <p class="fragment">
            There are several points of failure when building and maintaining a
            hook, so it is best to set up testing in layers:
          </p>
          <ul>
            <li class="fragment">
              Build a test suite that exercises the underlying logic and the
              CLI.
            </li>
            <li class="fragment">
              Run your test suite on different operating systems and Python
              versions.
            </li>
            <li class="fragment">
              Use <code>pre-commit</code> to run your hooks in your CI/CD
              workflows.
            </li>
          </ul>
          <p class="fragment">
            <em
              >Tip: See the <a href="#references">references slide</a> at the
              end for some examples.</em
            >
          </p>
        </section>
        <section id="document-your-hook">
          <h2>Document your hook</h2>
          <p>
            Make it easy for people to get started with your hook by including a
            setup snippet in your <code>README</code>. If you have command line
            arguments and/or support configuration files, mention some common
            configurations.
          </p>
          <div class="center">
            <img
              src="images/example-setup-snippet.png"
              alt="Example setup snippet from exif-stripper"
              style="margin-bottom: -10px"
            />
            <small
              ><em
                >Source:
                <a
                  href="https://github.com/stefmolin/exif-stripper"
                  rel="noopener noreferrer"
                  target="_blank"
                  >stefmolin/exif-stripper</a
                ></em
              ></small
            >
          </div>
        </section>
        <section id="share-your-hook">
          <h2>Sharing your hook with the world</h2>
          <ul>
            <li class="fragment">
              Once your repository is public on GitHub (or similar), your hook
              is available for use.
            </li>
            <li class="fragment">
              Help users find your hook by talking about it: conference talks,
              blog posts, tweets, <em>etc.</em>
            </li>
            <li class="fragment">
              Consider publishing it to PyPI if it is useful beyond just being a
              hook.
            </li>
          </ul>
        </section>
        <section id="tips-for-creating-hooks">
          <h2>Good to know</h2>
          <ul>
            <li class="fragment">
              Adjust your hook's behavior by supporting command line arguments
              or reading settings from a configuration file like
              <code>pyproject.toml</code>.
            </li>
            <li class="fragment">
              Multiple hooks can be defined in a single repository.
            </li>
            <li class="fragment">
              Hooks can run at different stages of the Git workflow (not just
              the pre-commit stage):
              <a
                href="https://pre-commit.com/#confining-hooks-to-run-at-certain-stages"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit.com/#confining-hooks-to-run-at-certain-stages</a
              >.
            </li>
            <li class="fragment">
              Hooks can be written in any language supported by
              <code>pre-commit</code> (see the list at
              <a
                href="https://pre-commit.com/#supported-languages"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit.com/#supported-languages</a
              >).
            </li>
          </ul>
        </section>
        <section id="references">
          <h2>References</h2>
          <ul class="references">
            <li>
              Setup article:
              <a
                href="https://stefaniemolin.com/articles/devx/pre-commit/setup-guide/"
                target="_blank"
                >How to Set Up Pre-Commit Hooks</a
              >
              by Stefanie Molin
            </li>
            <li>
              Official documentation:
              <a
                href="https://pre-commit.com/"
                target="_blank"
                rel="noopener noreferrer"
                >pre-commit.com</a
              >
              <ul style="margin-top: 0.5em">
                <li>
                  <a
                    href="https://pre-commit.com/#pre-commit-configyaml---hooks"
                    target="_blank"
                    rel="noopener noreferrer"
                    ><code>.pre-commit-config.yaml</code></a
                  >
                </li>
                <li>
                  <a
                    href="https://pre-commit.com/#creating-new-hooks"
                    target="_blank"
                    rel="noopener noreferrer"
                    ><code>.pre-commit-hooks.yaml</code></a
                  >
                </li>
                <li>
                  <a
                    href="https://pre-commit.com/#cli"
                    target="_blank"
                    rel="noopener noreferrer"
                    >CLI reference</a
                  >
                </li>
              </ul>
            </li>
            <li>
              Example of a published pre-commit hook:
              <a
                href="https://github.com/stefmolin/exif-stripper"
                target="_blank"
                rel="noopener noreferrer"
                ><code>exif-stripper</code></a
              >
              <ul style="margin-top: 0.5em">
                <li>
                  Test suite using <code>pytest</code>:
                  <a
                    href="https://github.com/stefmolin/exif-stripper/blob/main/tests/test_cli.py"
                    target="_blank"
                    rel="noopener noreferrer"
                    ><code>test_cli.py</code></a
                  >
                </li>
                <li>
                  Testing workflow with GitHub Actions:
                  <a
                    href="https://github.com/stefmolin/exif-stripper/blob/main/.github/workflows/ci.yml"
                    target="_blank"
                    rel="noopener noreferrer"
                    ><code>ci.yml</code></a
                  >
                </li>
              </ul>
            </li>
            <li>
              Example of
              <a
                href="https://github.com/search?q=repo%3Anumpy%2Fnumpydoc+path%3Anumpydoc%2Fhooks%2F**+parse_config+OR+find_project_root&type=code"
                target="_blank"
                rel="noopener noreferrer"
                >finding and parsing configuration files</a
              >
              like <code>pyproject.toml</code> (from the
              <a
                href="https://github.com/numpy/numpydoc"
                target="_blank"
                rel="noopener noreferrer"
                >numpydoc-validation</a
              >
              hook)
            </li>
            <li>
              Python Packaging User Guide:
              <a
                href="https://packaging.python.org/en/latest/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/"
                target="_blank"
                rel="noopener noreferrer"
                >Publishing package distribution releases using GitHub Actions
                CI/CD workflows</a
              >
            </li>
          </ul>
        </section>
        <section id="thank-you">
          <h2>Thank you!</h2>
          <p style="font-size: 0.65em">
            <em
              >I hope you enjoyed the workshop. You can follow my work on the
              following platforms:</em
            >
          </p>
          <div
            style="
              display: flex;
              justify-content: space-evenly;
              align-items: center;
            "
          >
            <div style="text-align: center; width: 30%">
              <img
                class="qr-code"
                src="https://raw.githubusercontent.com/stefmolin/pandas-workshop/main/media/qr-code.png"
              />
            </div>
            <div style="font-size: 0.85em">
              <div style="display: flex">
                <i
                  class="fa fa-globe fa-fw"
                  style="padding-right: 4px; margin: auto 0"
                ></i>
                <a href="https://stefaniemolin.com" rel="noopener noreferrer">
                  stefaniemolin.com
                </a>
              </div>
              <div style="display: flex">
                <i
                  class="fab fa-github fa-fw"
                  style="padding-right: 4px; margin: auto 0"
                ></i>
                <a
                  href="https://github.com/stefmolin"
                  rel="noopener noreferrer"
                  target="_blank"
                >
                  github.com/stefmolin
                </a>
              </div>
              <div style="display: flex">
                <i
                  class="fab fa-twitter fa-fw"
                  style="padding-right: 4px; margin: auto 0"
                ></i>
                <a
                  href="https://twitter.com/StefanieMolin"
                  rel="noopener noreferrer"
                  target="_blank"
                >
                  twitter.com/StefanieMolin
                </a>
              </div>
              <div style="display: flex">
                <i
                  class="fab fa-linkedin fa-fw"
                  style="padding-right: 4px; margin: auto 0"
                ></i>
                <a
                  href="https://linkedin.com/in/stefanie-molin"
                  rel="noopener noreferrer"
                  target="_blank"
                >
                  linkedin.com/in/stefanie-molin
                </a>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script src="https://unpkg.com/reveal.js@5.1.0/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
      integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8="
      crossorigin="anonymous"
    ></script>

    <!--syntax highlighting in code snippets-->
    <script src="https://unpkg.com/reveal.js@5.1.0/plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        controls: false,
        hash: true,

        keyboard: {
          // map numpad numbers to their top row equivalents
          97: () => Reveal.triggerKey(49), // 1
          98: () => Reveal.triggerKey(50), // 2
        },

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealHighlight],
      });
      [
        {
          name: "section 1",
          key: "1",
          id: "setting-up-pre-commit-hooks",
          keyCode: 49,
        },
        {
          name: "section 2",
          key: "2",
          id: "creating-a-pre-commit-hook",
          keyCode: 50,
        },
      ].forEach(({ id, key, name, keyCode }) => {
        Reveal.addKeyBinding(
          { keyCode, key, description: `Jump to ${name}` },
          () => {
            window.location = `#/${id}`;
          }
        );
      });

      // for working with dates/times
      const { DateTime, Duration } = luxon;

      // add exercise timer
      let updateExerciseTimerInterval;
      Reveal.addKeyBinding(
        { keyCode: 84, key: "T", description: "Start the exercise timer" },
        () => {
          const cleanup = () => {
            clearInterval(updateExerciseTimerInterval);
            $(".exercise-timer").remove();
          };

          cleanup();

          const inputId = "exercise-timer-duration";
          const promptDivClass = "exercise-duration-prompt";

          $(".reveal")
            .append(
              `
              <div class="jump-to-slide ${promptDivClass}">
                <input
                  id="${inputId}"
                  type="text"
                  class="jump-to-slide-input"
                  placeholder="Duration in minutes"
                  autocomplete="off"
                />
              </div>
            `
            )
            .on("keypress", function (e) {
              if (e.which === 13) {
                // pressed ENTER to submit time

                // get the value and remove the prompt
                let exerciseTime = parseFloat($(`#${inputId}`).val());
                $(`.${promptDivClass}`).remove();

                // set up the timer
                if (
                  exerciseTime !== undefined &&
                  exerciseTime !== "" &&
                  exerciseTime !== null
                ) {
                  if (!isNaN(exerciseTime) && exerciseTime >= 0.1) {
                    exerciseTime = Duration.fromMillis(
                      exerciseTime * 60 * 1000
                    );
                    const countDownTime = DateTime.now().plus(exerciseTime);

                    const getTimeText = (elapsedTime) =>
                      `‚è± ${elapsedTime.toFormat("mm:ss")}`;

                    if ($(".exercise-timer").length === 0) {
                      // add to DOM if not already there
                      $(".reveal").append(
                        `<aside class="exercise-timer" style="display: block; position: absolute; ` +
                          `top: 20px; left: 15px;` +
                          `font-size: 50px;"></aside>`
                      );
                    }

                    // in case the key is pressed while a timer is already running, clear the old one
                    if (!isNaN(updateExerciseTimerInterval))
                      clearInterval(updateExerciseTimerInterval);

                    // write the starting time minus the 1 second delay before the update
                    const updateFrequency = 1000;
                    $(".exercise-timer").text(
                      getTimeText(
                        exerciseTime.minus({ milliseconds: updateFrequency })
                      )
                    );

                    // update the remaining time each second
                    const updateTimer = () => {
                      const now = DateTime.now();
                      const elapsedTime = countDownTime.diff(now);
                      const secondsRemaining = elapsedTime.as("seconds");

                      if (secondsRemaining >= 1)
                        $(".exercise-timer").text(getTimeText(elapsedTime));
                      else if (secondsRemaining >= 0) {
                        $(".exercise-timer").text(
                          getTimeText(Duration.fromMillis(0))
                        );
                      } else if (secondsRemaining >= -5)
                        $(".exercise-timer")
                          .text("TIME'S UP")
                          .css("color", "red");
                      else cleanup();
                    };
                    updateExerciseTimerInterval = setInterval(
                      updateTimer,
                      updateFrequency
                    );
                  }
                } else cleanup();
              }
            });
          $(`#${inputId}`).focus();
        }
      );
    </script>
  </body>
</html>
